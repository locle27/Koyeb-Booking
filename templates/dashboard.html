{% extends "base.html" %}

{% block title %}Dashboard - Hotel Management{% endblock %}

{% block content %}
<div class="container-fluid px-4">
    <h1 class="mt-4">üìä Dashboard T·ªïng quan</h1>
    <ol class="breadcrumb mb-4">
        <li class="breadcrumb-item active">T·ªïng quan v·ªÅ hi·ªáu su·∫•t kh√°ch s·∫°n</li>
    </ol>

    <!-- Filter Form -->
    <div class="card mb-4">
        <div class="card-header">
            <i class="fas fa-filter"></i>
            T√πy ch·ªânh kho·∫£ng th·ªùi gian
        </div>
        <div class="card-body">
            <form method="get" action="{{ url_for('dashboard') }}" class="row g-3 align-items-center">
                <div class="col-md-5">
                    <label for="start_date" class="form-label">Ng√†y b·∫Øt ƒë·∫ßu</label>
                    <input type="date" id="start_date" name="start_date" class="form-control" value="{{ start_date }}">
                </div>
                <div class="col-md-5">
                    <label for="end_date" class="form-label">Ng√†y k·∫øt th√∫c</label>
                    <input type="date" id="end_date" name="end_date" class="form-control" value="{{ end_date }}">
                </div>
                <div class="col-md-2 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="fas fa-search"></i> L·ªçc
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ‚ö†Ô∏è KH√ÅCH CH∆ØA THU TI·ªÄN QU√Å H·∫†N -->
    {% if overdue_unpaid_guests and overdue_unpaid_guests|length > 0 %}
    <div class="alert alert-danger border-0 shadow-lg mb-4" style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);">
        <div class="d-flex align-items-center justify-content-between">
            <div>
                <h4 class="alert-heading text-white mb-2">
                    <i class="fas fa-exclamation-triangle me-2"></i>‚ö†Ô∏è KH√ÅCH CH∆ØA THU TI·ªÄN QU√Å H·∫†N
                </h4>
                <p class="text-white mb-0">{{ overdue_unpaid_guests|length }} kh√°ch ƒë√£ check-in nh∆∞ng ch∆∞a thu ti·ªÅn</p>
            </div>
            <div class="text-end">
                <div class="text-white">
                    <div class="h5 mb-0">{{ "{:,.0f}".format(overdue_total_amount if overdue_total_amount else 0) }}ƒë</div>
                    <small>T·ªïng ti·ªÅn ch∆∞a thu</small>
                </div>
            </div>
        </div>
        
        <hr class="text-white-50 my-3">
        
        <div class="row">
            {% for guest in overdue_unpaid_guests[:3] %}
            <div class="col-md-4 mb-2">
                <div class="card bg-white bg-opacity-90 border-0">
                    <div class="card-body py-2 px-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1 text-dark">{{ guest.get('T√™n ng∆∞·ªùi ƒë·∫∑t', 'N/A') }}</h6>
                                <small class="text-muted">
                                    <i class="fas fa-calendar me-1"></i>
                                    {% if guest.get('Check-in Date') %}
                                        {% if guest['Check-in Date'] is string %}
                                            {{ guest['Check-in Date'] }}
                                        {% else %}
                                            {{ guest['Check-in Date'].strftime('%d/%m/%Y') if guest['Check-in Date'] else 'N/A' }}
                                        {% endif %}
                                    {% else %}
                                        N/A
                                    {% endif %}
                                    <span class="ms-2 badge bg-danger">{{ guest.get('days_overdue', 0) }} ng√†y</span>
                                </small>
                            </div>
                            <div class="text-end">
                                <div class="fw-bold text-danger">{{ "{:,.0f}".format(guest.get('T·ªïng thanh to√°n', 0) if guest.get('T·ªïng thanh to√°n') else 0) }}ƒë</div>
                                <small class="text-muted">ID: {{ guest.get('S·ªë ƒë·∫∑t ph√≤ng', 'N/A') }}</small>
                                <button class="btn btn-success btn-sm mt-1 w-100" 
                                        onclick="openCollectModal('{{ guest.get('S·ªë ƒë·∫∑t ph√≤ng', '') }}', '{{ guest.get('T√™n ng∆∞·ªùi ƒë·∫∑t', '') }}', {{ guest.get('T·ªïng thanh to√°n', 0) }})">
                                    <i class="fas fa-money-bill-wave me-1"></i>Thu ti·ªÅn
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        {% if overdue_unpaid_guests|length > 3 %}
        <div class="text-center mt-3">
            <button class="btn btn-outline-light" onclick="toggleMoreOverdue()">
                <i class="fas fa-chevron-down me-1"></i> Xem th√™m {{ overdue_unpaid_guests|length - 3 }} kh√°ch
            </button>
        </div>
        <div id="moreOverdueGuests" style="display: none;" class="mt-3">
            <div class="row">
                {% for guest in overdue_unpaid_guests[3:] %}
                <div class="col-md-4 mb-2">
                    <div class="card bg-white bg-opacity-90 border-0">
                        <div class="card-body py-2 px-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-1 text-dark">{{ guest.get('T√™n ng∆∞·ªùi ƒë·∫∑t', 'N/A') }}</h6>
                                    <small class="text-muted">
                                        <i class="fas fa-calendar me-1"></i>
                                        {% if guest.get('Check-in Date') %}
                                            {% if guest['Check-in Date'] is string %}
                                                {{ guest['Check-in Date'] }}
                                            {% else %}
                                                {{ guest['Check-in Date'].strftime('%d/%m/%Y') if guest['Check-in Date'] else 'N/A' }}
                                            {% endif %}
                                        {% else %}
                                            N/A
                                        {% endif %}
                                        <span class="ms-2 badge bg-danger">{{ guest.get('days_overdue', 0) }} ng√†y</span>
                                    </small>
                                </div>
                                <div class="text-end">
                                    <div class="fw-bold text-danger">{{ "{:,.0f}".format(guest.get('T·ªïng thanh to√°n', 0) if guest.get('T·ªïng thanh to√°n') else 0) }}ƒë</div>
                                    <small class="text-muted">ID: {{ guest.get('S·ªë ƒë·∫∑t ph√≤ng', 'N/A') }}</small>
                                    <button class="btn btn-success btn-sm mt-1 w-100" 
                                            onclick="openCollectModal('{{ guest.get('S·ªë ƒë·∫∑t ph√≤ng', '') }}', '{{ guest.get('T√™n ng∆∞·ªùi ƒë·∫∑t', '') }}', {{ guest.get('T·ªïng thanh to√°n', 0) }})">
                                        <i class="fas fa-money-bill-wave me-1"></i>Thu ti·ªÅn
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
    {% endif %}

    <!-- Key Metrics -->
    <div class="row">
        <div class="col-xl-3 col-md-6">
            <div class="card bg-primary text-white mb-4">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <div class="fs-5">Doanh thu</div>
                            <div class="fs-3 fw-bold">{{ "{:,.0f}".format(total_revenue) }}ƒë</div>
                        </div>
                        <i class="fas fa-coins fa-3x"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="card bg-success text-white mb-4">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <div class="fs-5">L∆∞·ª£ng kh√°ch</div>
                            <div class="fs-3 fw-bold">{{ total_guests }}</div>
                        </div>
                        <i class="fas fa-users fa-3x"></i>
                    </div>
                </div>
            </div>
        </div>
        <!-- More metrics can be added here -->
    </div>

    <!-- Charts -->
    <!-- Bi·ªÉu ƒë·ªì doanh thu chuy√™n nghi·ªáp -->
    <div class="row">
        <div class="col-xl-12">
            <div class="card mb-4 shadow-sm border-0">
                <div class="card-header bg-gradient text-white" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <i class="fas fa-chart-line me-2"></i>
                            <span class="fw-bold">üìà Doanh thu theo th√°ng (T·∫•t c·∫£ th·ªùi gian)</span>
                        </div>
                        <div class="badge bg-light text-dark">Chi ti·∫øt ƒë·∫ßy ƒë·ªß</div>
                    </div>
                </div>
                <div class="card-body">
                    <div id="monthlyRevenueChart" style="height: 400px;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- B·∫£ng chi ti·∫øt v√† ph√¢n t√≠ch -->
    {% if monthly_revenue_with_unpaid %}
    <div class="row">
        <div class="col-xl-8">
            <div class="card shadow-sm border-0">
                <div class="card-header bg-light">
                    <h6 class="mb-0">
                        <i class="fas fa-table me-1 text-primary"></i> 
                        Chi ti·∫øt Doanh thu theo th√°ng (Bao g·ªìm kh√°ch ch∆∞a thu ti·ªÅn)
                    </h6>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle">
                            <thead class="table-dark">
                                <tr>
                                    <th class="border-0">
                                        <i class="fas fa-calendar-alt me-1"></i>Th√°ng
                                    </th>
                                    <th class="text-end border-0">
                                        <i class="fas fa-check-circle me-1 text-success"></i>ƒê√£ thu
                                    </th>
                                    <th class="text-end border-0">
                                        <i class="fas fa-clock me-1 text-warning"></i>Ch∆∞a thu
                                    </th>
                                    <th class="text-center border-0">
                                        <i class="fas fa-users me-1 text-info"></i>Kh√°ch ch∆∞a thu
                                    </th>
                                    <th class="text-end border-0">
                                        <i class="fas fa-coins me-1 text-info"></i>T·ªïng c·ªông
                                    </th>
                                    <th class="text-center border-0">
                                        <i class="fas fa-percentage me-1 text-primary"></i>T·ª∑ l·ªá thu
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for row in monthly_revenue_with_unpaid %}
                                <tr class="border-bottom">
                                    <td>
                                        <div class="fw-bold text-primary">{{ row.get('Th√°ng', 'N/A') }}</div>
                                    </td>
                                    <td class="text-end">
                                        <div class="fw-bold text-success">
                                            {{ "{:,.0f}".format(row.get('ƒê√£ thu', 0) | float) }}ƒë
                                        </div>
                                    </td>
                                    <td class="text-end">
                                        <div class="fw-bold text-danger">
                                            {{ "{:,.0f}".format(row.get('Ch∆∞a thu', 0) | float) }}ƒë
                                        </div>
                                    </td>
                                    <td class="text-center">
                                        {% set uncollected_count = row.get('S·ªë kh√°ch ch∆∞a thu', 0) %}
                                        {% if uncollected_count > 0 %}
                                        <span class="badge bg-warning text-dark">
                                            {{ uncollected_count }} kh√°ch
                                        </span>
                                        {% else %}
                                        <span class="badge bg-success">
                                            <i class="fas fa-check"></i> ƒê√£ thu h·∫øt
                                        </span>
                                        {% endif %}
                                    </td>
                                    <td class="text-end">
                                        {% set total = (row.get('ƒê√£ thu', 0) | float) + (row.get('Ch∆∞a thu', 0) | float) %}
                                        <div class="fw-bold text-dark">
                                            {{ "{:,.0f}".format(total) }}ƒë
                                        </div>
                                    </td>
                                    <td class="text-center">
                                        {% set collected = row.get('ƒê√£ thu', 0) | float %}
                                        {% set uncollected = row.get('Ch∆∞a thu', 0) | float %}
                                        {% set total = collected + uncollected %}
                                        {% set percentage = (collected / total * 100) if total > 0 else 0 %}
                                        <div class="progress" style="height: 20px;">
                                            <div class="progress-bar {% if percentage >= 90 %}bg-success{% elif percentage >= 70 %}bg-warning{% else %}bg-danger{% endif %}" 
                                                 role="progressbar" 
                                                 style="width: {{ percentage }}%;" 
                                                 aria-valuenow="{{ percentage }}" 
                                                 aria-valuemin="0" aria-valuemax="100">
                                                <small class="fw-bold">{{ "{:.1f}%".format(percentage) }}</small>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-4">
            <div class="card shadow-sm border-0">
                <div class="card-header bg-light">
                    <h6 class="mb-0">
                        <i class="fas fa-chart-pie me-1 text-primary"></i> 
                        Ph√¢n b·ªï theo Ng∆∞·ªùi thu
                    </h6>
                </div>
                <div class="card-body">
                    <div id="collectorChart" style="height: 300px;"></div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<!-- Modal Thu Ti·ªÅn -->
<div class="modal fade" id="collectPaymentModal" tabindex="-1" aria-labelledby="collectPaymentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="collectPaymentModalLabel">
                    <i class="fas fa-money-bill-wave me-2"></i>Thu Ti·ªÅn Kh√°ch H√†ng
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="collectPaymentForm">
                    <div class="mb-3">
                        <label class="form-label">T√™n kh√°ch h√†ng:</label>
                        <div class="fw-bold text-primary" id="modalGuestName"></div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">M√£ ƒë·∫∑t ph√≤ng:</label>
                        <div class="fw-bold text-muted" id="modalBookingId"></div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">T·ªïng s·ªë ti·ªÅn c·∫ßn thu:</label>
                        <div class="fw-bold text-danger fs-5" id="modalTotalAmount"></div>
                    </div>
                    <div class="mb-3">
                        <label for="collectedAmount" class="form-label">S·ªë ti·ªÅn th·ª±c thu (VND):</label>
                        <input type="number" class="form-control" id="collectedAmount" 
                               placeholder="Nh·∫≠p s·ªë ti·ªÅn ƒë√£ thu" min="0" step="1000">
                        <div class="form-text">C√≥ th·ªÉ thu m·ªôt ph·∫ßn ho·∫∑c to√†n b·ªô s·ªë ti·ªÅn</div>
                    </div>
                    <div class="mb-3">
                        <label for="collectorName" class="form-label">Ng∆∞·ªùi thu ti·ªÅn:</label>
                        <select class="form-select" id="collectorName" required>
                            <option value="">Ch·ªçn ng∆∞·ªùi thu ti·ªÅn</option>
                            <option value="LOC LE">LOC LE</option>
                            <option value="THAO LE">THAO LE</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="paymentNote" class="form-label">Ghi ch√∫ (tu·ª≥ ch·ªçn):</label>
                        <textarea class="form-control" id="paymentNote" rows="2" 
                                  placeholder="Ghi ch√∫ v·ªÅ vi·ªác thu ti·ªÅn..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                <button type="button" class="btn btn-success" id="confirmCollectBtn" onclick="collectPayment()">
                    <i class="fas fa-check me-1"></i>X√°c nh·∫≠n thu ti·ªÅn
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('Dashboard loaded, initializing charts...');
    
    // Monthly Revenue Chart
    const monthlyRevenueChartData = {{ monthly_revenue_chart_json | tojson | safe }};
    console.log('Monthly revenue chart data:', monthlyRevenueChartData);
    
    if (monthlyRevenueChartData && 
        typeof monthlyRevenueChartData === 'object' && 
        Object.keys(monthlyRevenueChartData).length > 0 &&
        monthlyRevenueChartData.data && 
        monthlyRevenueChartData.layout) {
        try {
            Plotly.newPlot('monthlyRevenueChart', monthlyRevenueChartData.data, monthlyRevenueChartData.layout, {
                responsive: true,
                displayModeBar: false
            });
            console.log('Monthly revenue chart rendered successfully');
        } catch (error) {
            console.error('Error rendering monthly revenue chart:', error);
            document.getElementById('monthlyRevenueChart').innerHTML = 
                '<div class="alert alert-danger">L·ªói hi·ªÉn th·ªã bi·ªÉu ƒë·ªì: ' + error.message + '</div>';
        }
    } else {
        console.log('No monthly revenue chart data available');
        document.getElementById('monthlyRevenueChart').innerHTML = 
            '<div class="text-center py-5"><i class="fas fa-chart-line fa-3x text-muted mb-3"></i><p class="text-muted">Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ hi·ªÉn th·ªã bi·ªÉu ƒë·ªì</p></div>';
    }

    // Collector Revenue Pie Chart
    const collectorChartData = {{ collector_chart_json | tojson | safe }};
    console.log('Collector chart data:', collectorChartData);
    
    if (collectorChartData && 
        typeof collectorChartData === 'object' && 
        Object.keys(collectorChartData).length > 0 &&
        collectorChartData.data && 
        Array.isArray(collectorChartData.data) &&
        collectorChartData.data.length > 0 &&
        collectorChartData.data[0].values && 
        Array.isArray(collectorChartData.data[0].values) &&
        collectorChartData.data[0].values.length > 0 &&
        collectorChartData.layout) {
        try {
            Plotly.newPlot('collectorChart', collectorChartData.data, collectorChartData.layout, {
                responsive: true,
                displayModeBar: false
            });
            console.log('Collector chart rendered successfully');
        } catch (error) {
            console.error('Error rendering collector chart:', error);
            document.getElementById('collectorChart').innerHTML = 
                '<div class="alert alert-danger">L·ªói hi·ªÉn th·ªã bi·ªÉu ƒë·ªì: ' + error.message + '</div>';
        }
    } else {
        console.log('No collector chart data available or empty values');
        document.getElementById('collectorChart').innerHTML = 
            '<div class="text-center py-5"><i class="fas fa-chart-pie fa-3x text-muted mb-3"></i><p class="text-muted">Kh√¥ng c√≥ d·ªØ li·ªáu ng∆∞·ªùi thu ti·ªÅn</p></div>';
    }
});

// Toggle more overdue guests
function toggleMoreOverdue() {
    const moreOverdue = document.getElementById('moreOverdueGuests');
    const button = event.target;
    
    if (moreOverdue.style.display === 'none') {
        moreOverdue.style.display = 'block';
        button.innerHTML = '<i class="fas fa-chevron-up me-1"></i> Thu g·ªçn';
    } else {
        moreOverdue.style.display = 'none';
        button.innerHTML = '<i class="fas fa-chevron-down me-1"></i> Xem th√™m {{ overdue_unpaid_guests|length - 3 if overdue_unpaid_guests else 0 }} kh√°ch';
    }
}

// Global variables cho modal
let currentBookingId = '';
let currentTotalAmount = 0;

// M·ªü modal thu ti·ªÅn
function openCollectModal(bookingId, guestName, totalAmount) {
    currentBookingId = bookingId;
    currentTotalAmount = totalAmount;
    
    // C·∫≠p nh·∫≠t th√¥ng tin modal
    document.getElementById('modalGuestName').textContent = guestName;
    document.getElementById('modalBookingId').textContent = bookingId;
    document.getElementById('modalTotalAmount').textContent = totalAmount.toLocaleString('vi-VN') + 'ƒë';
    
    // Reset form
    document.getElementById('collectedAmount').value = totalAmount;
    document.getElementById('collectorName').value = '';
    document.getElementById('paymentNote').value = '';
    
    // Hi·ªÉn th·ªã modal
    const modal = new bootstrap.Modal(document.getElementById('collectPaymentModal'));
    modal.show();
}

// X·ª≠ l√Ω thu ti·ªÅn
async function collectPayment() {
    const collectedAmount = parseInt(document.getElementById('collectedAmount').value) || 0;
    const collectorName = document.getElementById('collectorName').value;
    const paymentNote = document.getElementById('paymentNote').value;
    
    // Validate
    if (!collectorName) {
        alert('Vui l√≤ng ch·ªçn ng∆∞·ªùi thu ti·ªÅn!');
        return;
    }
    
    if (collectedAmount <= 0) {
        alert('Vui l√≤ng nh·∫≠p s·ªë ti·ªÅn h·ª£p l·ªá!');
        return;
    }
    
    if (collectedAmount > currentTotalAmount) {
        if (!confirm(`S·ªë ti·ªÅn thu (${collectedAmount.toLocaleString('vi-VN')}ƒë) l·ªõn h∆°n s·ªë ti·ªÅn c·∫ßn thu (${currentTotalAmount.toLocaleString('vi-VN')}ƒë). B·∫°n c√≥ ch·∫Øc ch·∫Øn?`)) {
            return;
        }
    }
    
    // Hi·ªÉn th·ªã loading
    const confirmBtn = document.getElementById('confirmCollectBtn');
    const originalText = confirmBtn.innerHTML;
    confirmBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>ƒêang x·ª≠ l√Ω...';
    confirmBtn.disabled = true;
    
    try {
        const response = await fetch('/api/collect_payment', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                booking_id: currentBookingId,
                collected_amount: collectedAmount,
                collector_name: collectorName,
                payment_note: paymentNote
            })
        });
        
        const result = await response.json();
        
        if (result.success) {
            // Th√†nh c√¥ng - ƒë√≥ng modal v√† reload trang
            const modal = bootstrap.Modal.getInstance(document.getElementById('collectPaymentModal'));
            modal.hide();
            
            // Hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng
            const successAlert = document.createElement('div');
            successAlert.className = 'alert alert-success alert-dismissible fade show position-fixed';
            successAlert.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            successAlert.innerHTML = `
                <strong>‚úÖ Thu ti·ªÅn th√†nh c√¥ng!</strong><br>
                ƒê√£ thu ${collectedAmount.toLocaleString('vi-VN')}ƒë t·ª´ kh√°ch ${document.getElementById('modalGuestName').textContent}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(successAlert);
            
            // T·ª± ƒë·ªông ·∫©n sau 5 gi√¢y
            setTimeout(() => {
                if (successAlert.parentNode) {
                    successAlert.remove();
                }
            }, 5000);
            
            // Reload trang sau 2 gi√¢y ƒë·ªÉ c·∫≠p nh·∫≠t d·ªØ li·ªáu
            setTimeout(() => {
                window.location.reload();
            }, 2000);
            
        } else {
            alert('L·ªói: ' + (result.message || 'Kh√¥ng th·ªÉ thu ti·ªÅn'));
        }
        
    } catch (error) {
        console.error('Payment collection error:', error);
        alert('L·ªói k·∫øt n·ªëi. Vui l√≤ng th·ª≠ l·∫°i!');
    } finally {
        // Reset button
        confirmBtn.innerHTML = originalText;
        confirmBtn.disabled = false;
    }
}
</script>
{% endblock %}